/*!
 * Copyright 2019 acrazing <joking.young@gmail.com>. All rights reserved.
 * @since 2019-11-20 15:52:09
 */

import WebSocket from 'ws';
import { STMPServer, STMPServerAdaptor } from './STMPServer';
import { WebSocketConnection } from './WebSocketConnection';

export interface WebSocketAdaptorOptions {}

export class WebSocketAdaptor implements STMPServerAdaptor {
  readonly server: WebSocket.Server;

  constructor(server: WebSocket.Server, options: WebSocketAdaptorOptions = {}) {
    this.server = server;
  }

  attach(server: STMPServer): void {
    this.server.on('connection', (socket, request) => {
      new WebSocketConnection(server, socket, request);
    });
  }
}
